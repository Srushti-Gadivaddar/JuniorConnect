<% layout("/layouts/boilerplate") %>

<style>
:root {
    --bg: #f5f7fb;
    --text: #0b2347;
    --card: #ffffff;
    --btn: #2f5589;
    --btn-text: #ffffff;
    --accent: #1B3C53;
}

[data-theme="dark"] {
    --bg: #0f172a;
    --text: #e2e8f0;
    --card: #1e293b;
    --btn: #334155;
    --btn-text: #e2e8f0;
    --accent: #2b4d63;
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', sans-serif;
    margin: 0;
}

/* Form Container */
.form-container {
    background: var(--card);
    padding: 40px 30px;
    border-radius: 20px;
    max-width: 800px;
    margin: 50px auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transition: background 0.3s ease;
}

h3 {
    margin-bottom: 30px;
    font-weight: 700;
    text-align: center;
}

/* Form Fields */
.form-control {
    border-radius: 10px;
    padding: 10px 12px;
    border: 1px solid #ced4da;
}
.form-control:focus {
    border-color: var(--btn);
    box-shadow: 0 0 0 0.2rem rgba(47,85,137,0.25);
}
.form-label {
    font-weight: 500;
    margin-bottom: 6px;
}

/* Buttons */
.btn-primary, .btn-next {
    background-color: var(--btn);
    color: var(--btn-text);
    border: none;
    border-radius: 8px;
    margin-top: 15px;
    width: 120px;
}
.btn-primary:hover, .btn-next:hover {
    transform: translateY(-2px);
}
.btn-secondary, .btn-prev {
    background-color: #6c757d;
    color: #fff;
    border-radius: 8px;
    margin-top: 15px;
    width: 120px;
}

/* Steps */
.step { display: none; }
.step.active { display: block; }

/* Profile Image Preview */
#profilePreview {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 15px;
}

/* Responsive */
@media (max-width: 768px) {
    .btn-next, .btn-prev, .btn-primary { width: 100%; }
}
</style>

<div class="form-container">
    <h3>Create Your Profile</h3>

    <form id="createProfileForm" method="post" action="/profiles" class="needs-validation" novalidate enctype="multipart/form-data">

        <!-- Step 1: Basic Info -->
        <div class="step active" id="step1">
            <div class="mb-3">
                <label for="fullname" class="form-label">Full Name:</label>
                <input type="text" placeholder="Add your name" name="profile[name]" class="form-control" required/>
                <div class="invalid-feedback">Please enter your full name.</div>
            </div>
            <div class="mb-3">
                <label for="branch" class="form-label">Branch:</label>
                <input type="text" placeholder="Computer Science and Engineering" name="profile[branch]" class="form-control" required/>
                <div class="invalid-feedback">Branch is missing.</div>
            </div>
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-next">Next</button>
            </div>
        </div>

        <!-- Step 2: Role & Batch -->
        <div class="step" id="step2">
            <div class="row">
                <div class="mb-3 col-md-4">
                    <label for="batch" class="form-label">Batch:</label>
                    <input type="number" placeholder="2025" name="profile[batch]" class="form-control" required/>
                    <div class="invalid-feedback">Batch is missing.</div>
                </div>
                <div class="mb-3 col-md-8">
                    <label for="role" class="form-label">Role:</label>
                    <input type="text" placeholder="Junior, Senior, or Alumni" name="profile[role]" class="form-control" required/>
                    <div class="invalid-feedback">Role is missing.</div>
                </div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-prev">Back</button>
                <button type="button" class="btn btn-next">Next</button>
            </div>
        </div>

        <!-- Step 3: Profile Picture & Bio -->
        <div class="step" id="step3">
            <div class="mb-3 text-center">
                <img id="profilePreview" src="/images/default-profile.png">
            </div>
            <div class="mb-3">
                <label for="fileInput" class="form-label">Profile Picture:</label>
                <input type="file" id="fileInput" name="profile[profile_pic]" class="form-control" />
            </div>
            <div class="mb-3">
                <label for="bio" class="form-label">Bio:</label>
                <textarea name="profile[bio]" placeholder="Hi! I am learning web-development" class="form-control" required></textarea>
                <div class="invalid-feedback">Please add a catchy info about you.</div>
            </div>
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-prev">Back</button>
                <button type="submit" class="btn btn-primary">Create Profile</button>
            </div>
        </div>
    </form>
</div>

<script>
// Step logic
const steps = document.querySelectorAll(".step");
let currentStep = 0;

const btnNext = document.querySelectorAll(".btn-next");
const btnPrev = document.querySelectorAll(".btn-prev");

btnNext.forEach(btn => btn.addEventListener("click", () => {
    if(!validateStep(currentStep)) return;
    steps[currentStep].classList.remove("active");
    currentStep++;
    if(currentStep >= steps.length) currentStep = steps.length -1;
    steps[currentStep].classList.add("active");
}));

btnPrev.forEach(btn => btn.addEventListener("click", () => {
    steps[currentStep].classList.remove("active");
    currentStep--;
    if(currentStep < 0) currentStep = 0;
    steps[currentStep].classList.add("active");
}));

function validateStep(step) {
    let inputs = steps[step].querySelectorAll("input, textarea");
    let valid = true;
    inputs.forEach(input => {
        if(!input.checkValidity()) valid = false;
        input.classList.add("was-validated");
    });
    return valid;
}

// Profile image preview
document.getElementById("fileInput").addEventListener("change", function(event) {
    const file = event.target.files[0];
    if(file) {
        document.getElementById("profilePreview").src = URL.createObjectURL(file);
    }
});
</script>
