<!-- <% layout("/layouts/boilerplate") %>

<style>
.edit-box {
  background: var(--bubble-left);
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 4px 12px var(--bubble-shadow);
  color: var(--text-primary);
}

.section-title {
  font-weight: 700;
  font-size: 18px;
  color: var(--text-primary);
  margin-bottom: 10px;
}

.input-area {
  background: var(--input-bg);
  border: 1px solid #ccc;
  border-radius: 12px;
  padding: 12px;
  width: 100%;
  color: var(--text-primary);
}

.img-thumb {
  width: 110px;
  border-radius: 12px;
  box-shadow: 0 3px 8px var(--bubble-shadow);
}

.file-pill {
  background: var(--bubble-right);
  padding: 6px 12px;
  border-radius: 10px;
  margin-right: 8px;
  color: var(--text-primary);
}

.btn-soft {
  background: var(--bubble-right);
  color: var(--text-primary);
  border: none;
  padding: 10px 18px;
  border-radius: 12px;
  font-weight: 600;
}
.btn-cancel {
  background: var(--bubble-left);
  padding: 10px 16px;
  border-radius: 10px;
  border: 1px solid #aaa;
  color: var(--text-secondary);
}
</style>

<div class="container mt-4">
  <h2 style="color:var(--text-primary); font-weight:700;" class="mb-4">Edit Answer</h2>

  <div class="edit-box">

    <form action="/questions/<%= question._id %>/answers/<%= answer._id %>?_method=PUT"
          method="POST" enctype="multipart/form-data">


      <label class="section-title">Edit Your Answer</label>
      <textarea name="text" rows="6" class="input-area mb-4"><%= answer.text %></textarea>

      <% if (answer.images && answer.images.length) { %>
        <div class="section-title">Existing Images</div>
        <div class="d-flex flex-wrap mb-3">
          <% answer.images.forEach(img => { %>
            <div class="me-3 mb-3 text-center">
              <img src="<%= img.url %>" class="img-thumb" />
              <form method="POST"
                    action="/questions/<%= question._id %>/answers/<%= answer._id %>/images/<%= encodeURIComponent(img.filename) %>/delete">
                <button class="btn btn-danger btn-sm mt-2">Remove</button>
              </form>
            </div>
          <% }) %>
        </div>
      <% } %>

      <% if (answer.files && answer.files.length) { %>
        <div class="section-title">Existing Files</div>
        <div class="mb-3">
          <% answer.files.forEach(file => { %>
            <div class="mb-2">
              <a href="<%= file.url %>" target="_blank" class="file-pill">ðŸ“„ <%= file.filename %></a>
              <form method="POST" action="/questions/<%= question._id %>/answers/<%= answer._id %>/files/<%= encodeURIComponent(file.filename) %>/delete" class="d-inline">
                <button class="btn btn-danger btn-sm">Remove</button>
              </form>
            </div>
          <% }) %>
        </div>
      <% } %>

      <div class="section-title mt-4">Upload New Images</div>
      <input type="file" name="images" multiple class="input-area mb-3">

      <div class="section-title">Upload New Files</div>
      <input type="file" name="files" multiple class="input-area mb-4">

      <button class="btn-soft">Save Changes</button>
      <a href="/questions/<%= question._id %>" class="btn-cancel ms-2">Cancel</a>
    </form>
  </div>
</div> -->

<style>
:root {
  /* Light mode colors */
  --bg-card: linear-gradient(145deg, #f0f4f8, #dbe4ed);
  --bg-input: linear-gradient(145deg, #e8edf3, #d1dbe6);
  --bg-badge: linear-gradient(145deg, #c8d8e8, #b0c8db);
  --bg-button: linear-gradient(145deg, #a0c4d8, #7da9bf);
  --text-primary: #1f2b38;
  --border-light: rgba(0,0,0,0.08);
}

[data-theme="dark"] {
  --bg-card: linear-gradient(145deg, #39434f, #2b323c);
  --bg-input: linear-gradient(145deg, #2b323c, #1f262d);
  --bg-badge: linear-gradient(145deg, #2c3f50, #1f2b38);
  --bg-button: linear-gradient(145deg, #1f3745, #16222c);
  --text-primary: #e0e7ff;
  --border-light: rgba(255,255,255,0.1);
}

/* Common styling */
.card {
  border-radius: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  transition: all 0.3s;
  background: var(--bg-card);
  color: var(--text-primary);
}

textarea, input.form-control {
  border-radius: 12px;
  border: 1px solid var(--border-light);
  background: var(--bg-input);
  color: var(--text-primary);
  transition: all 0.3s;
}

textarea:focus, input.form-control:focus {
  box-shadow: 0 0 8px rgba(63,169,245,0.5);
  outline: none;
}

.badge {
  background: var(--bg-badge);
  color: var(--text-primary);
  transition: all 0.3s;
}

.btn-save, .btn-cancel {
  border-radius: 12px;
  background: var(--bg-button);
  color: var(--text-primary);
  transition: all 0.3s;
}

.btn-save:hover, .btn-cancel:hover,
.badge:hover {
  transform: scale(1.05);
}

.img-thumbnail:hover {
  transform: scale(1.05);
}

#editLightbox {
  background: rgba(40,50,60,0.95);
}
#lbImg {
  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
}
</style>

<div class="container mt-4">
  <h2 class="mb-4 fw-bold" style="color: var(--text-primary);">Edit Answer</h2>

  <div class="card p-4">
    <form action="/questions/<%= question._id %>/answers/<%= answer._id %>?_method=PUT" method="POST" enctype="multipart/form-data">

      <!-- Answer Text -->
      <div class="mb-4">
        <label class="form-label fw-bold" style="color: var(--text-primary);">Edit Your Answer</label>
        <textarea name="text" class="form-control" rows="6"><%= answer.text %></textarea>
      </div>

      <!-- Existing Images -->
      <% if (answer.images && answer.images.length) { %>
      <div class="mb-3">
        <h6 class="fw-bold" style="color: var(--text-primary);">Existing Images</h6>
        <div class="d-flex flex-wrap gap-3">
          <% answer.images.forEach(img => { %>
          <div class="text-center position-relative">
            <img src="<%= img.url %>" class="img-thumbnail rounded existing-img" style="width: 110px; height: 80px; object-fit: cover; cursor: pointer;" data-src="<%= img.url %>">
            <form method="POST" action="/questions/<%= question._id %>/answers/<%= answer._id %>/images/<%= encodeURIComponent(img.filename) %>/delete">
              <button class="btn btn-danger btn-sm mt-2 w-100">Remove</button>
            </form>
          </div>
          <% }) %>
        </div>
      </div>
      <% } %>

      <!-- Existing Files -->
      <% if (answer.files && answer.files.length) { %>
      <div class="mb-3">
        <h6 class="fw-bold" style="color: var(--text-primary);">Existing Files</h6>
        <div class="d-flex flex-column gap-2">
          <% answer.files.forEach(file => { %>
          <div class="d-flex align-items-center gap-2">
            <a href="<%= file.url %>" target="_blank" class="badge rounded-pill">ðŸ“„ <%= file.filename %></a>
            <form method="POST" action="/questions/<%= question._id %>/answers/<%= answer._id %>/files/<%= encodeURIComponent(file.filename) %>/delete">
              <button class="btn btn-danger btn-sm">Remove</button>
            </form>
          </div>
          <% }) %>
        </div>
      </div>
      <% } %>

      <!-- Upload New Images -->
      <div class="mb-3">
        <label class="form-label fw-bold" style="color: var(--text-primary);">Upload New Images</label>
        <input type="file" name="images" id="newImages" class="form-control mb-2" multiple>
        <div class="d-flex flex-wrap gap-2" id="imagePreview"></div>
      </div>

      <!-- Upload New Files -->
      <div class="mb-4">
        <label class="form-label fw-bold" style="color: var(--text-primary);">Upload New Files</label>
        <input type="file" name="files" id="newFiles" class="form-control mb-2" multiple>
        <div class="d-flex flex-wrap gap-2" id="filePreview"></div>
      </div>

      <button type="submit" class="btn btn-save fw-bold">Save Changes</button>
      <a href="/questions/<%= question._id %>" class="btn btn-cancel ms-2 fw-bold">Cancel</a>
    </form>
  </div>
</div>

<!-- Lightbox -->
<div id="editLightbox" class="d-none position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center">
  <button class="btn btn-light position-absolute top-0 end-0 m-3" style="font-size:28px;" id="lbClose">&times;</button>
  <img src="" alt="Preview" class="img-fluid rounded" id="lbImg">
</div>
